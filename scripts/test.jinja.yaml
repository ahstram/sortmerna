#
# FILE: test.jinja.yaml
# Created: Oct 27, 2019 Sun
#
# Tests configuration
# Rendered using Jinja
#

test.list:
  - t0: test_blast_format_0 - single reference + single read
  - t0_other: test_blast_format_0_other - single reference + single read
  - t1: test_blast_format_1 - single reference + single read
  - t2: test_cigar_lcs_1
  - t3: test_environmental_output
  - t4: test_indexing_split_databases
  - t5: test_mate_pairs - part 1
  - t6:
  - t7:
  - t8:
  - t9: test_output_all_alignments_f_rc
  - t10:
  - t11:
  - t12:
  - t13:
  - t14:
  - t15:
    #       best   N  min_lis refs  reads  zip
  - t16:   [  1,   1,  2,  2,   2,     True]
  - t16_2: [  1,   0,  2,  2,   2,     True]
  - t16_3: [  1,   2,  2,  2,   2,     True]
  - t16_4: [  0,   1,  2,  2,   2,     True]
  - t16_5: [  0,   2,  2,  2,   2,     True]
  - t17:
  - t18:
  #              output type                                                   |    alignment type
  #        refs  reads  paired  paired_in  paired_out  out2  sout  zout  other | best  N  min_lis seeds
  - t19:   [ 2,    2,     1,      1,          0,         0,    0,    0,    1,      1,  1,    2,     2 ]
  - t19_1: [ 2,    2,     1,      1,          0,         1,    0,    0,    1,      1,  1,    2,     2 ]
  - t19_2: [ 2,    2,     1,      0,          1,         0,    0,    0,    1,      1,  1,    2,     2 ]
  - t19_3: [ 2,    2,     1,      0,          1,         1,    0,    0,    1,      1,  1,    2,     2 ]
  - t19_4: [ 2,    2,     1,      0,          0,         1,    0,    0,    1,      1,  1,    2,     2 ]
  #
  - t20:   [ 2,    1,     1,      1,          0,         0,    0,    0,    1,      1,  1,    2,     2 ]
  - t20_1: [ 2,    1,     1,      1,          0,         1,    0,    0,    1,      1,  1,    2,     2 ]
  - t20_2: [ 2,    1,     1,      0,          1,         0,    0,    0,    1,      1,  1,    2,     2 ]
  - t20_3: [ 2,    1,     1,      0,          1,         1,    0,    0,    1,      1,  1,    2,     2 ]
  - t20_4: [ 2,    1,     1,      0,          0,         1,    0,    0,    1,      1,  1,    2,     2 ]
  - t21:
  - t22:
  - t23:
  - t24:
  - t25:
  - t26:
  - t27:
  - t28:
  - t29:
  - t30:
  - t31:
  - t32:
  - t33:
  - t34:
  - t35:
  - t36:
  - t37:
  - t38:
  - t39:
  - t40: pre-stress  - 8 reference databases + 2500 reads
  - t41: stress test - 8 reference databases + 1M reads
  - t42: stress test - 8 reference databases + 10M reads
  - t43: stress test - 8 reference databases + 50M reads

t0:
  name: test_blast_format_0
  inf: |
    single reference + single read
    Compares expected alignment (see 't0.validate.files[0]' below) to the newly produced one

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      -        -           -         -     -     -    -

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '0'
    - -v
    - -threads
    - '1'
    - -workdir
    - {{WRK_DIR}}
  validate: 
    func: t0 # name of the validation function
    num_reads: 1
    num_hits: 1
    num_fail: 0
    min_len: 1487
    max_len: 1487
    files:
      - {{ SMR_SRC }}/data/t0_expected_alignment.blast

t0_other:
  name: test_blast_format_0_other
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout other
    ------------------------------------------------------------------ output type
     1      1      -        -           -         -     -     -    -

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '1 qstrand'
    - -v
    - -threads
    - '1'
  validate: 
    func:
    num_reads: 1
    num_hits: 1
    num_fail: 0
    min_len: 1487
    max_len: 1487
    files:
      - {{ SMR_SRC }}/data/t0_expected_alignment.blast

t1:
  name: test_blast_format_1
  inf: |
    same input as t0
    using default number of threads (2)
    blast format is different than tests 0, 0_other
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '1'
    - -v
    - -threads
    - '1'
  validate: 
    func:
    num_reads: 1
    num_hits: 1
    num_fail: 0
    min_len: 1487
    max_len: 1487
    files:
      - {{ SMR_SRC }}/data/t0_expected_alignment.blast

t2:
  name: test_cigar_lcs_1
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '1 qstrand cigar'
    - -v
    - -threads
    - '1'
    #- -workdir
    #- {{ SMR_SRC }}/run
  validate: 
    func: t2
    # expected alignment
    expected: [ "AB271211", "Unc49508", "93.5", "1430", "64", "30", "58", "1487", "1", "1446", "0",
              "2069", "+", "57S57M2I12M2D4M2I29M1D11M2I3M2D11M1I7M1D13M5D4M3D9M2D3M7D1260M" ]

t3:
  name: test_environmental_output
  info: |
    search for a single best alignment per read i.e.

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      -        -           -         -     -     -    -

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set2_environmental_study_550_amplicon.fasta
    - -max_pos
    - '250'
    - -otu_map
    - -de_novo_otu
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -v
    - -threads
    - '4'
    #- -no-best
    #- -num_alignments
    #- '2'
    #- -task
    #- '2'
  validate: 
    func: t3
    num_reads:      100000
    num_hits:        99999
    num_fail:            1
    num_denovo:      52018 # pass SW & fail (%Cov & %ID)   num_denovo + num_pass_id_cov = num_hits
    num_pass_id_cov: 47981 # pass SW + %Cov + %ID
    num_groups: [264, 264] # 264 lnx (sometimes), 265 win (bizarre behavior of Lnx VM on Win host)
    non_aligned_id: L1S23.273699_272664 # 0_64412  the only non-aligned read of this test
    runtime:
      win:
        - threads: 8
          sec: [12.5046, 0.714079, 4.0937] # align, log, reports

# original test only performed indexing i.e. no alignment and not reads
# TODO: add option '-i' 'index only'?
t4:
  name: test_indexing_split_databases
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/gg_13_8_ref_set.fasta # 27,424 bytes (27KB) file
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta # single read
    - -m
    - '0.05'
    - -v
    - -threads
    - '1'
  validate: 
    func: t4
    num_reads: 1
    num_hits: 1
    num_fail: 0
    min_len: 1487
    max_len: 1487
    idx_sfx_win: 7828442710921335713
    idx_sfx_lin: 12011197668640222139
    num_idx: 7 # 7 index files of each kind is generated

t5:
  name: test_mate_pairs - part 1
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -max_pos
    - '250'
    - -fastx
    - -other
    - -v
    - -threads
    - '5'
    #- -pid
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:    sanger # fastq quality variant

t6:
  name: test_mate_pairs - part 2 - paired_in
  info: |
    -e      min_sw  hits
     1          49  6000
     0.001      59  6000
     1e-7       74  6000
     1e-12      93  6000
     1e-15     105  6000
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq # 5,000 reads
    - -max_pos
    - '250'
    - -fastx
    - -other
    - -paired_in
    - -blast
    - '1 cigar qcov'
    - -v
    - -e
    - '0.01'
    - -threads
    - '4'
  validate:
    func:
    num_reads:   10000
    num_hits:     6000
    num_fail:     4000
    num_aligned: 10000 # number of reads in aligned.fastx
    num_other:       0 # number of reads in other.fastx. Empty file: WARN: skbio\io\registry.py:548: does not look like a fastq file
    variant:    sanger # fastq quality variant

t7:
  name: test_mate_pairs - part 3 - paired_out
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq # 5,000 reads
    - -max_pos
    - '250'
    - -fastx
    - -other
    - -paired_out
    - -v
  validate:
    func:
    num_reads:   10000
    num_hits:    6000
    num_fail:    4000
    num_aligned: 2000 # number of paired reads in aligned.fastx
    num_other:   8000 # number paired reads in other.fastx
    variant:    sanger # fastq quality variant

t8:
  name: test_multiple_databases_search
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ SMR_SRC }}/data/set7_arc_bac_16S_database_match.fasta # 6 reads
    - -fastx
    - -v
  validate:
    func:
    num_reads: 6
    num_hits: 4
    num_fail: 2

t9:
  name: test_output_all_alignments_f_rc
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/ref_GQ099317_forward_and_rc.fasta
    - -reads
    - {{ SMR_SRC }}/data/illumina_GQ099317.fasta # 1 read
    - -num_alignments
    - '0'
    - -sam
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '1'
  validate:
    func: t9
    num_reads: 1
    num_hits:  1
    num_fail:  0
    sam_alignments_expected: [
      [
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '0',
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '1',
          '255',
          '101M',
          '*',
          '0',
          '0',
          'GCTGGCACGGAGTTAGCCGGGGCTTATAAATGGTACCGTCATTGATTCTTCCCATTCTTTCGAAGTTTACATCCCGAGGGACTTCATCCTTCACGCGGCGT',
          '*',
          'AS:i:202',
          'NM:i:0'
      ],
      [
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '16',
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '102',
          '255',
          '101M',
          '*',
          '0',
          '0',
          'ACGCCGCGTGAAGGATGAAGTCCCTCGGGATGTAAACTTCGAAAGAATGGGAAGAATCAATGACGGTACCATTTATAAGCCCCGGCTAACTCCGTGCCAGC',
          '*',
          'AS:i:202',
          'NM:i:0'
      ]
    ]

t10:
  name: test_ref_shorter_than_seed
  note: |
    This captures the output of the command and verifies the error message.
    No output files are produced
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/ref_short_seqs.fasta
    - -reads
    - {{ SMR_SRC }}/data/illumina_GQ099317.fasta # 1 read
    - -v
    - -workdir
    - {{ WRK_DIR }}
  cwd:
  capture: True
  validate:
    func: t10
    err_msg: 'one of your sequences is shorter than the seed length 19'

t11:
  name: test_simulated_amplicon_1_part_map
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -otu_map
    - -de_novo_otu
    - -blast
    - '1 cigar qcov'
    - -fastx
    - -other
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '3'
  validate:
    func: t11
    num_reads: 30000
    num_hits:  19995
    num_fail:  10005
    num_denovo: 9831
    num_pass_id_cov: 10164 #   10164 + 9831 = 19995  pass_SW + pass_ID, not necessarily pass_Cov
    num_cluster: [4400, 4401]
    blast:
      num_recs:       19995
      num_pass_id:    10175 
      num_pass_cov:   15054 
      num_pass_id_cov: 9733 # pass_SW + pass_ID + pass_Cov

t12:
  name: test_simulated_amplicon_1_part_map
  note: same as t11 + 'best 5'
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -otu_map
    - -de_novo_otu
    - -blast
    - '1 cigar qcov'
    - -best
    - '5'
    - -fastx
    - -other
    - -v
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func: t12
    num_reads: 30000
    min_sw:       49
    num_hits: 19995
    num_fail: 10005
    num_denovo: 9831
    num_pass_id_cov: 10164 #   10164 + 9831 = 19995, pass_SW + pass_ID, not necessarily pass_Cov
    num_cluster: [4400, 4401]
    blast:
      num_recs:       28545
      num_pass_id:    10467 
      num_pass_cov:   16536 
      num_pass_id_cov: 9849 # pass_SW + pass_ID + pass_Cov

t13:
  name: test_simulated_amplicon_6_part_map
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -otu_map
    - -de_novo_otu
    - -blast
    - '1 cigar qcov'
    - -fastx
    - -other
    # indexing options
    - -m
    - '20'
    - -v
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func: t13
    num_reads: 30000
    num_hits: 19995
    num_fail: 10005
    num_denovo: 9831
    num_pass_id_cov: 10164 #   10164 + 9831 = 19995, pass_SW + pass_ID, not necessarily pass_Cov
    num_cluster: [4400, 4401]
    blast:
      num_recs:       19995
      num_pass_id:    10175 
      num_pass_cov:   15054 
      num_pass_id_cov: 9733 # pass_SW + pass_ID + pass_Cov

t14:
  name: test_simulated_amplicon_12_part_map
  note: identical to t13 except using 12-part index instead of 6-part
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -otu_map
    - -de_novo_otu
    - -blast
    - '1 cigar qcov'
    - -fastx
    - -other
    # indexing options
    - -m
    - '10'
    - -v
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func: t14
    num_reads: 30000
    num_hits: 19995
    num_fail: 10005
    num_denovo: 9831
    num_pass_id_cov: 10164 #   10164 + 9831 = 19995, pass_ID + pass_Cov, not necessarily pass_SW
    num_cluster: [4400, 4401] # 4400 before bug 52
    blast:
      num_recs:       19995
      num_pass_id:    10175 
      num_pass_cov:   15054 
      num_pass_id_cov: 9733 # pass_SW + pass_ID + pass_Cov

t15:
  name: test_threads
  info: |
    ref  reads  best  N  min_lis zip
    ---------------------------------
    1    2      true  1  2       true
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -threads
    - '6:2:2' # can be any 6 | 6:2 | 6:2:2
    - '-a' # deprecated. Redirects to 'threads'
    - '5'
    - -v
    - -workdir
    - {{ WRK_DIR }}

t16:
  name: test_relative_path
  info: |
    search a single best alignment per read
    ref  reads  best  N  min_lis
    ---------------------------
    2    2      true  1  2 
  note:
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -num_alignments
    - '1'
    - -v
    - -threads
    - '4'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000

t16_2:
  name:
  info: |
    relative paths
    search All alignments per read
    ref  reads  best  N  min_lis
    ---------------------------
    2    2      true  0  2 
  note:
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -blast
    - '1 cigar qcov'
    - -num_alignments
    - '0'
    - -v
    - -threads
    - '4'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads:  10000
    num_hits:    6000
    num_fail:    4000
    num_blast: 128598 # ~21 alignments per read

t16_3:
  name:
  info: |
    relative paths
    zip in - zip out
    search 2 best alignment per read
    ref  reads  best  N  min_lis
    ---------------------------
    2    2      true  2  2 
  note:
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -num_alignments
    - '2'
    - -v
    - -threads
    - '4'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads:  10000
    num_hits:    6000
    num_fail:    4000
    num_blast:  11389 # ~1.9 alignments per read

t16_4:
  name:
  info: |
    relative paths, 
    zip in - zip out
    search any single alignment per read
    ref  reads  best   N  min_lis
    ---------------------------
    2    2      false  1  2 
  note:
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -no-best
    - -v
    - -threads
    - '4'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads:  10000
    num_hits:    6000
    num_fail:    4000
    num_blast:   6000 # 1 alignment per read

t16_5:
  name:
  info: |
    relative paths, 
    zip in - zip out
    search for any 2 alignments per read
    ref  reads  best   N  min_lis
    ---------------------------
    2    2      false  2  2 
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -no-best
    - -num_alignments
    - '2'
    - -v
    - -threads
    - '4'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads:  10000
    num_hits:    6000
    num_fail:    4000
    num_blast:  11389 # ~1.9 alignments per read

t17:
  name: test_indexing
  info: |
    test indexing, workdir
    ref  reads  best   N  min_lis zip
    ----------------------------------
    8    2      true   1  2       true
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '8'
  cwd: {{ SMR_SRC }}
  validate:
    func: t17
    num_reads: 10000
    num_hits:   5944
    num_fail:   4056

t18:
  name: 2 paired reads files + paired_in + joint FWD/REV output
  info: |
    Test the new option '-out2' (issue 202)
    Test different E-values
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '4'
  validate:
    func:
    num_reads:  10000
    num_hits:    9188
    num_fail:     812
    num_aligned: 9852
    num_other:    148
    variant:    sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t19:
  name: 2 reads + paired_in
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        1           -         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2

    Test the new option '-out2' (issue 202)
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -threads
    - '4'
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_1:
  name: 2 reads + paired_in + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        1           -         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2 
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    - -out2
    - -threads
    - '4'
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_2:
  name: 2 reads + paired_out
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        -           1         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2 
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -v
    - -threads
    - '4'
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_3:
  name: 2 reads + paired_out + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        -           1         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -out2
    - -v
    - -threads
    - '4'
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_4:
  name: 2 reads + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        -           -         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -out2
    - -v
    - -threads
    - '4'
  validate:
    func:
    num_reads:  10000
    num_hits:    9833
    num_fail:     167
    num_ali_fwd: 4876 # count of reads in aligned_fwd.fastq
    num_ali_rev: 4957 # count of reads in aligned_ref.fastq
    num_oth_fwd:  124
    num_oth_rev:   43
    variant:         sanger # fastq quality variant
    blast:
      num_recs:  9833
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t20:
  name: 1 reads + paired_in
  info: |
    Test the new option '-out2' (issue 202)

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      1      1        1           -         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '4'
  validate:
    func:
    num_hits:    9188
    num_fail:     812
    num_aligned: 9852
    num_other:    148
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t20_1:
  name: 1 reads + paired_in + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        1           -         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -out2
    - -v
    - -threads
    - '4'
  validate:
    func:
    num_hits:    9188
    num_fail:     812
    num_aligned: 9852
    num_other:    148
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t20_2:
  name: 1 reads + paired_out
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        -           1         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -v
    - -threads
    - '4'
  validate:
    func:
    num_hits:    9188
    num_fail:     812
    num_aligned: 9852
    num_other:    148
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t20_3:
  name: 1 reads + paired_out + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        -           1         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -out2
    - -v
    - -threads
    - '4'
  validate:
    func:
    num_hits:    9188
    num_fail:     812
    num_aligned: 9852
    num_other:    148
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t20_4:
  name: 1 reads + paired + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        -           0         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired
    - -out2
    - -v
    - -threads
    - '4'
  validate:
    func:
    num_hits:    9833
    num_fail:     167
    num_ali_fwd: 4876
    num_ali_rev: 4957
    num_oth_fwd:  124
    num_oth_rev:   43
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9833

t21:
  name: single paired reads file + paired_in + separate FWD/REV output
  note: |
    Same as test 20 + 'out2' option
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    - -out2
  validate:
    func:
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926
    num_aligned_rev: 4926
    num_other_fwd:     74
    num_other_rev:     74
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t22:
  name: single paired reads file + joint FWD/REV output
  note: |
    Test the new option '-out2' (issue 202)
    ...                               paired_in 
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -v
    #- -out2
  validate:
    func:
    num_hits:    9188
    num_fail:     812
    num_aligned: 9188
    num_other:    812
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass SW + ID + Cov

t23:
  name: single paired reads file + separate FWD/REV output
  note: |
    Same as 22 but FWD and REV output to different files
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -v
    - -paired
    - -out2
  validate:
    func:
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4281
    num_aligned_rev: 4907
    num_other_fwd:    719
    num_other_ref:     93
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t24:
  name: 1 paired reads file + joint FWD/REV output
  note: |
    Same as 22 but 'paired' is used without 'out2' => FWD and REV output to the same files
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -v
    - -paired
  validate:
    func:
    num_hits:    9188
    num_fail:     812
    num_aligned: 9188
    num_other:    812
    variant:     sanger # fastq quality variant
    blast:
      num_recs:     9188
      num_pass_id:    16 
      num_pass_cov:
      num_pass_id_cov: # pass_SW + pass_ID + pass_Cov

t25:
  name: test_aligned_opt
  note: |
    ref  reads  best  N  min_lis
    ---------------------------
    2    2 gz   true  1  2
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -fastx
    - -aligned
    - out1/out2/set4
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:   sanger # fastq quality variant

t26:
  name: test_output_opt
  note: |
    Options and their combinations to test:
    -workdir
    -kvdb
    -idx
    -aligned
    -other
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -kvdb
    - run/kvdb_1
    - -idx
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/set4_aligned
    - -other
    - run/out_1/set4_other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:   sanger # fastq quality variant

t27:
  name: test_output_opt_other_bool
  note: |
    Options and their combinations to test:
    -workdir
    -kvdb
    -idx
    -aligned
    -other
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -kvdb
    - run/kvdb_1
    - -idx
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/set4_aligned
    - -other
    - -workdir
    - {{ WRK_DIR }}
    - -v
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:   sanger # fastq quality variant

t28:
  name: test_output_opt_aligned_bool_other_bool
  note: |
    Options and their combinations to test:
    -workdir
    -kvdb
    -idx
    -aligned
    -other
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -kvdb
    - run/kvdb_1
    - -idx
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/
    - -other
    - -v
    - -workdir
    - {{WRK_DIR}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:   sanger # fastq quality variant

t29:
  name: test_output_opt_no_workdir
  note: |
    Options and their combinations to test:
    -kvdb
    -idx
    -aligned 'no file name' -> use default 'aligned'
    -other   'boolean' -> to be placed in the same location as aligned output
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -kvdb
    - run/kvdb_1
    - -idx
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:   sanger # fastq quality variant

t30:
  name: test_output_opt_no_workdir_no_idx
  note: |
    Options and their combinations to test:
     no workdir
     no idx
    -kvdb
    -aligned 'no file name' -> use default 'aligned'
    -other   'boolean' -> to be placed in the same location as aligned output
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -kvdb
    - run/kvdb_1
    - -fastx
    - -blast
    - -aligned
    - run/out/
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:   sanger # fastq quality variant

t31:
  name: test_output_opt_no_workdir_no_idx
  note: |
    Options and their combinations to test:
     no workdir
     no idx
    -kvdb
    -aligned 'no file name' -> use default 'aligned'
    -other   'boolean' -> to be placed in the same location as aligned output
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -kvdb
    - run/kvdb_1
    - -fastx
    - -aligned
    - run/out/
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000
    num_hits:   6000
    num_fail:   4000
    variant:   sanger # fastq quality variant

t32:
  name: 2 reads + no_best + N_1 + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '1'
    - -no-best
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:      9188
      num_pass_id:     21
      num_pass_cov:    11
      num_pass_id_cov:  0 # pass_SW + pass_ID + pass_Cov
    runtime:
      win:
        - threads: 8
          sec: [0.743277, 0.348923, 0.672172] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []

t33:
  name: 2 reads + best + N_1 + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '1 cigar qcov'
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:      9188
      num_pass_id:     16
      num_pass_cov:     0
      num_pass_id_cov:  0 # pass_SW + pass_ID + pass_Cov
    runtime:
      win:
        - threads: 8
          sec: [0.743277, 0.348923, 0.672172] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []

t34:
  name: 2 reads + best + N_3 + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '3'
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:     16701
      num_pass_id:     30 
      num_pass_cov:    12
      num_pass_id_cov:  0 # pass_SW + pass_ID + pass_Cov
    runtime:
      win:
        - threads: 8
          sec: [1.07325, 0.337265, 0.650805] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []

t35:
  name: 2 reads + N_0 (all alignments) + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '0'
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    num_reads:      10000
    num_hits:        9188
    num_fail:         812
    num_aligned_fwd: 4926 # count of reads in aligned_fwd.fastq
    num_aligned_rev: 4926 # count of reads in aligned_ref.fastq
    num_other_fwd:     74
    num_other_rev:     74
    variant:         sanger # fastq quality variant
    blast:
      num_recs:     47552
      num_pass_id:    113
      num_pass_cov:    12
      num_pass_id_cov:  0 # pass_SW + pass_ID + pass_Cov
    time:
      win:
        - threads: 8
          sec: [1.07325, 0.337265, 0.650805] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []


#
# custom tests
#
t36:
  name: Single reads file, 250 reads
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/sortmerna/data/reads/ecoli100.1.head1000.fq
  - -num_alignments
  - '1'
  - -fastx
  - -v
  validate:
    func: t16

t37:
  name: Paired reads
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
  - -ref
  - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
  - -reads 
  # SRR7721017_1.fastq | SRR7721017_1_100.fastq | SRR7721017_1_15.fastq
  - {{ DATA_DIR if DATA_DIR }}/sortmerna/reads/paired_reads_test/SRR7721017_1.fastq.gz # 20 MB  639240 reads
  - -reads
  # SRR7721017_2.fastq | SRR7721017_2_100.fastq | SRR7721017_2_15.fastq
  - {{ DATA_DIR if DATA_DIR }}/sortmerna/reads/paired_reads_test/SRR7721017_2.fastq.gz # 23 MB  639240 reads
  - -v
  - -fastx
  - -paired_in
  - -blast
  - '1 cigar qcov'
  - -sam
  - -threads
  - '8'
  - -workdir
  - {{ WRK_DIR }}
  validate:
    func:
    num_reads: 1278480
    num_hits:    66387
    num_fail:  1212093
    read_len: [75, 75, 75] # min, max, avr
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      total:
        4-2-0: []
        4-3-0: [24, 35, 1, 19] # ~80 sec
      index_stats_calc:  # sec

t38:
  name: Paired reads GZ 2 x 2 GB
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta # 12,734,464 ~12MB
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1.fastq.gz # 2 GB 24,654,594 reads
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2.fastq.gz # 2 GB 24,654,594 reads
  - -v
  - -blast
  - '1 cigar qcov'
  - -sam
  validate:
    func:
    num_reads: 49309188
    num_hits:    687225
    num_fail:  48621963
    time:          1841.62 # 1015.39 + 404.34 + 421.89 = 1841.62 / 60 = 30.69  (4608.04 >1hr on a busy VM on Win host)
    cpus:             8

t39:
  name: issue 207
  note: |
    sortmerna -m 4096 -a 4 -L 8 --fastx --blast 1 --workdir test 
      --num_alignments 0 --ref /path/rRNA_index.fasta --reads test.fq --other test2_mir.fq
    sortmerna -m 4096 -a 4 -L 8 --fastx --blast 1 --workdir test 
      --best 0 --ref /path/rRNA_index.fasta --reads test.fq --other test2_mir.fq
    sortmerna -m 4096 -a 4 -L 10 --fastx --blast 1 --workdir test 
      --best 0 -min_lis 1 --ref /path/rRNA_index.fasta --reads test.fq --other test2_mir.fq
    result:
      Total reads passing E-value threshold = 300025 (2.00)
      Total reads failing E-value threshold = 14699975 (98.00)
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta # 
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/smr_iss_207_20200123_test.fq.gz #
  #- -num_alignments
  #- '0'
  - -e
  - '100'
  - -fastx
  - -blast
  - '1'
  validate:
    func:
    num_reads: 15000000
    num_hits:    798426 #  5.32
    num_fail:  14201574 # 94.68
    time:           860.05 # 678.62 + 87.14 + 94.29 = 860.05 / 60 = 14.33 min
    cpus:             8

t40:
  name: issue 231 8x2500
  note: 8 reference databases + 2500 reads
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1_5K.fastq.gz # 1,250 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2_5K.fastq.gz # 1,250 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -v
    - -workdir
    - {{ WRK_DIR }}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 2500
    num_hits:   127
    num_fail:  2373
    variant:   sanger # fastq quality variant
    time:
      win_8_16:
        host: Windows 10 + 8 CPUs + 16 GiB RAM
        total: 37.01 # sec
        index_stats_calc: 4.01 # sec
        align:
          # [ load idx, load refs, align ] # sec
          - [2.033460, 0.0194314, 1.115530]
          - [1.899010, 0.1086190, 1.018200]
          - [1.286980, 0.1299090, 1.294970]
          - [1.981140, 0.1445470, 1.139560]
          - [0.346673, 0.0055980, 1.201430]
          - [0.692833, 0.0498388, 0.957983]
          - [0.838499, 0.1390180, 0.943279]
          - [0.283566, 0.0261384, 0.979882]
        stats:
          # [ load refs, calculate ] # sec
          - [0.1260650, 0.879666]
          - [0.1934290, 0.756772]
          - [0.2242860, 0.819015]
          - [0.2043470, 0.635339]
          - [0.0059149, 0.612893]
          - [0.0556958, 0.638558]
          - [0.1631920, 0.580496]
          - [0.0345357, 0.553701]
        reports: 
          # [ load refs, write ] # sec
          - [0.1663490, 0.710342]
          - [0.1235280, 0.714348]
          - [0.1318760, 0.613343]
          - [0.1876370, 0.770931]
          - [0.0242187, 0.639989]
          - [0.0822904, 0.718219] 
          - [0.2027080, 0.810572]
          - [0.0692027, 0.797114]
        total:   []
      ubuntu18_4_16_32:
        host: AWS t3.xlarge + Ubuntu 18 + 4 cpu + 16 GB RAM + 32 GB HD
        align:
          # [ load idx, load refs, align   ] # sec
          - [0.673854, 0.02615310, 0.0894852]
          - [0.637125, 0.01947890, 0.0715212]
          - [0.526297, 0.01813620, 0.0874868]
          - [0.793489, 0.03505870, 0.0743625]
          - [0.108825, 0.00112116, 0.0438021]
          - [0.228702, 0.00607886, 0.0482503]
          - [0.333577, 0.03573250, 0.0475301]
          - [0.116219, 0.00789596, 0.0478913]
      ubuntu18_8_32_32:
        host: AWS t3.2xlarge + Ubuntu 18 + 8 cpu + 32 GB RAM + 32 GB HD
        total: 435.83 # sec - python trace from command sent to response received. Includes index building
        reads_stats_calc: [0.00403101, 0.00386887, ] # 2 x 1250 = 2500
        index_stats_calc: [4.63, ]
        # average CPU load as shown by 'top'
        cpu_load: 96 # apparently because the threads idling most of the time
        align:
          # [ load idx, load refs, align   ] # sec
          - [0.673508, 0.02614100, 0.1287440]
          - [0.688735, 0.02109240, 0.0734461]
          - [0.700572, 0.02214820, 0.0520064]
          - [0.833986, 0.03527280, 0.0475622]
          - [0.127238, 0.00107915, 0.0282112]
          - [0.287171, 0.00621006, 0.0306184]
          - [0.328916, 0.03380940, 0.0540666]
          - [0.121714, 0.00850745, 0.0456736]
      ubuntu18_16_64_32:
        host: AWS m5.4xlarge + Ubuntu 18 + 16 cpu + 64 GB RAM + 32 GB HD
        # alignment cpu load: [ max,   min,  avr]
        cpu_load_align:       [0, 0,    ] 
        total: 507.63 # sec - python trace from command sent to response received - with indexing
        reads_stats_calc: [1.63729, 1.63938, ]
        index_stats_calc: [4.62, ]
        align:
          # [ load idx, load refs, align   ] # sec
          - [0.660503, 0.02655530, 11.8961]
          - [0.549080, 0.01971100, 11.7154]
          - [0.513501, 0.01789650, 12.6161]
          - [0.778753, 0.03570890, 13.1982]
          - [0.107538, 0.00110315, 6.58972]
          - [0.224024, 0.00597738, 7.61811]
          - [0.299101, 0.03337340, 8.39568]
          - [0.108896, 0.00776617, 7.11024]
    memory:
      win_8_16:
        prior_idx_load:   [5036, ] # MB
        idx_load:         378584 # MB
        ref_load:         395820 # MB
        align_done:       [404848, 379752, 370604, 500176, 155276, 214912, 271628, 258980] # MB
        idx_ref_unloaded: 98144 # MB

t41:
  name: issue 231 8x1M
  note: stress test - 8 reference databases + 1M reads
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1_2M.fastq.gz # 40MB, 500,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2_2M.fastq.gz # 40MB, 500,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '8'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 1000000
    num_hits:    49909
    num_fail:   950091
    variant:    sanger # fastq quality variant
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      total: 
        4-2-0: 225 # sec - ~4min - no indexing
        #      [align, summary, report]
        4-3-0: [ 95,    3,       50 ] # 1.5 times faster!
      #                 [file_1,  file_2,    both ] sec
      reads_stats_calc: [1.06534, 1.01161, 2.07695] # 1M reads
      index_stats_calc: 
      align:
        # [ load idx, load refs, align   ] # sec
        - [1.609760, 0.1460960, 13.8608]
        - [1.569410, 0.0944589, 13.7952]
        - [1.435490, 0.0912657, 17.2376]
        - [1.895420, 0.1422490, 19.3190]
        - [0.284600, 0.0065129, 10.7379]
        - [0.640762, 0.0723266, 11.4848]
        - [0.788337, 0.1347490, 11.5609]
        - [0.292100, 0.0274563, 10.7468]
      stats:   []
      reports: []
      total:
    ubuntu18_4_16_32:
      host: AWS t3.xlarge + Ubuntu 18 + 4 cpu + 16 GB RAM + 32 GB HD
      total: 315.02 # sec - python trace from command sent to response received
      align:
        # [ load idx, load refs, align   ] # sec
        - [0.760232, 0.02598330, 28.7143]
        - [0.561553, 0.01946190, 28.5440]
        - [0.526224, 0.01802220, 31.6420]
        - [0.800176, 0.03483680, 35.0931]
        - [0.109194, 0.00113233, 15.5079]
        - [0.228446, 0.00601414, 19.1100]
        - [0.304582, 0.03343890, 23.4172]
        - [0.115192, 0.00771964, 15.7117]
    ubuntu18_8_32_32:
      host: AWS t3.2xlarge + Ubuntu 18 + 8 cpu + 32 GB RAM + 32 GB HD
      # alignment cpu load: [ max,   min,  avr]
      cpu_load_align:       [768.3, 534.2,    ] # all cores working
      total: 248.359 # sec - python trace from command sent to response received - no indexing
      reads_stats_calc: [1.65323, 1.63713, ]
      index_stats_calc: [4.66, ]
      align:
        # [ load idx, load refs, align   ] # sec
        - [0.761488, 0.02586880, 18.2870]
        - [0.562772, 0.01954540, 18.8262]
        - [0.528802, 0.01783780, 17.4979]
        - [0.797004, 0.03432540, 18.6449]
        - [0.108343, 0.00108414, 10.5488]
        - [0.229871, 0.00602308, 13.4270]
        - [0.304157, 0.03303930, 14.9851]
        - [0.111445, 0.00778464, 11.0326]
    ubuntu18_16_64_32:
      host: AWS m5.4xlarge + Ubuntu 18 + 16 cpu + 64 GB RAM + 32 GB HD
      # alignment cpu load: [ max,   min,  avr]
      cpu_load_align:       [1540, 897.7,    ] 
      total: 507.63 # sec - python trace from command sent to response received - with indexing
      reads_stats_calc: [1.63729, 1.63938, ]
      index_stats_calc: [4.62, ]
      align:
        # [ load idx, load refs, align   ] # sec
        - [0.660503, 0.02655530, 11.8961]
        - [0.549080, 0.01971100, 11.7154]
        - [0.513501, 0.01789650, 12.6161]
        - [0.778753, 0.03570890, 13.1982]
        - [0.107538, 0.00110315, 6.58972]
        - [0.224024, 0.00597738, 7.61811]
        - [0.299101, 0.03337340, 8.39568]
        - [0.108896, 0.00776617, 7.11024]
    ubuntu18_32_128_32:
      # ~10 min to setup the instance and run the test: 1.536 / 6 = 0.256 per test
      host: AWS m5.8xlarge + Ubuntu 18 + 32 cpu + 128 GB RAM + 32 GB HD
      # alignment cpu load: [ max,   min,  avr]
      cpu_load_align:       [] 
      total: 485.936 # sec - python trace from command sent to response received - with indexing
      reads_stats_calc: [4.51]
      index_stats_calc: [ ]
      align:
        # [ load idx, load refs, align   ] # sec
        - [0.648937, 0.02581660, 7.42657]
        - [0.541040, 0.01928010, 7.36926]
        - [0.506856, 0.01764540, 7.54293]
        - [0.762611, 0.03471340, 7.83780]
        - [0.105484, 0.00107155, 5.39101]
        - [0.220171, 0.00586116, 5.68825]
        - [0.293652, 0.03250720, 5.88965]
        - [0.106713, 0.00752926, 5.59118]
  memory:
    prior_idx_load: []
    idx_load:       []
    ref_load:       []
    align_done:     []
    idx_ref_unloaded:

t42:
  name: issue 231 8x10M
  note: stress test - 8 reference databases + 10M reads
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1_20M.fastq.gz # 5M reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2_20M.fastq.gz # 5M reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '8'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 10000000 # 10M
    num_hits:    520127 #  5.2%
    num_fail:   9479873 # 94.8%
    variant:    sanger # fastq quality variant
    num_hits_db:
      euk_28s_id98: 0.52
      euk_18s_id95: 0.02
      bac_23s_id98: 3.25
      bac_16s_id90: 1.37
      arc_23s_id98: 0
      arc_16s_id95: 0
      nc_5s_id98:   0.04  # non-coding - RFAM
      nc_5.8s_id98: 0     # non-coding - RFAM
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      notes:
      ref:
        - {{DATA_DIR}}/logs/sortmerna/win10_8_16_smr_t42_20200811_0905.log
      cpu_load_align: [0, 0,    ] 
      total: 3167.055 # sec ~53min with indexing
      reads_stats_calc: [12.759, 11.2564]
      index_stats_calc: [3.53]
      align:
        # [ load idx, load refs, align   ] # sec
        - [1.605620, 0.1169340, 181.983]
        - [1.953170, 0.1422260, 230.752]
        - [1.786920, 0.1307010, 263.262]
        - [2.183380, 0.1681940, 286.366]
        - [0.389963, 0.0063583, 155.173]
        - [0.655249, 0.0311714, 161.248]
        - [0.895592, 0.1327380, 185.717]
        - [0.356574, 0.0285677, 156.206]
      stats:   []
      reports: []
    ubuntu18_8_16_32:
      host: AWS c5.2xlarge + Ubuntu 18 + 8 cpu + 16 GB RAM + 32 GB HDD
      notes: |
        {{DATA_DIR}}/logs/sortmerna/
          aws_ubuntu18_8_16_smr_t42_20200811_1319.log
          aws_ubuntu18_8_16_smr_t42_20200812_1224.log
      total: 2112.456 # sec ~35min - 1.5 times faster than Win due the higher memory usage
      reads_stats_calc: [15.209, 15.2475]
      index_stats_calc: [4.13]
      align:
        # [ load idx, load refs, align   ] # sec
        - [0.6063, 0.0235, 127.800] # slow because All reads were stored to DB. See results after the fix below.
        - [0.5058, 0.0174, 129.218]
        - [0.4738, 0.0160, 145.244]
        - [0.7163, 0.0316, 156.436]
        - [0.0989, 0.0009, 85.0219] # ExecutionTimedOut bug
        - [0.2071, 0.0054, 95.7626]
        - [0.2750, 0.0300, 107.765]
        - [0.1001, 0.0069, 80.1587]
        - [2.984,  0.132,  927.406] # Total: 15.51min
        # aws_ubuntu18_8_16_smr_t42_20200812_1224.log  storing only reads with new alignments  20200812
        - [0.6039, 0.0288, 94.5576] # 25% better
        - [0.4850, 0.0220, 90.1960] # 30%
        - [0.4534, 0.0205, 104.777] # 28%
        - [0.6907, 0.0380, 120.065] # 23%
        - [0.0942, 0.0012, 50.7922] # 41%
        - [0.1971, 0.0066, 52.7791] # 45%
        - [0.2634, 0.0325, 59.6349] # 47%
        - [0.0965, 0.0074, 50.4277] # 38%
        - [2.885,  0.157,  623.230] # Total: 10.4min 33% better
      stats:
        - [0.0236, 38.732]
        - [0.0262, 38.744]
        - [0.0206, 38.770]
        - [0.0327, 38.729]
        - [0.0012, 38.701]
        - [0.0067, 38.771]
        - [0.0313, 38.736]
        - [0.0075, 38.724]
        - [0.1498, 309.907] # Total: 5.2min
      reports: []
    ubuntu18_16_32_32:
      host: AWS c5.4xlarge + Ubuntu 18 + 16 cpu + 32 GB RAM + 32 GB HDD
      notes: |
        {{DATA_DIR}}/logs/sortmerna/
          aws_ubuntu18_16_32_smr_t42_20200812_1441.log
        Using 16 threads almost makes no sense. Compared to 8 threads the speed gain is minimal.
        The single reader is not fast enough to supply the reads, so the threads are idling.
      total:  # sec 
      reads_stats_calc: [15.25, 15.29]
      index_stats_calc: [4.42]
      align:
        # [ load idx, load refs, align   ] # sec
        - [0.64, 0.030, 56.25]
        - [0.51, 0.023, 55.70]
        - [0.48, 0.022, 60.85]
        - [0.73, 0.040, 69.54]
        - [0.10, 0.001, 52.61]
        - [0.21, 0.007, 53.17]
        - [0.28, 0.033, 54.36]
        - [0.10, 0.007, 52.17]
t43:
  name: issue 231 8x50M
  info: |
    stress test - 8 reference databases, 50M reads

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     8      2      -        -           -         -     -     y    -

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1.fastq.gz # 2 GB 24,654,594 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2.fastq.gz # 2 GB 24,654,594 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - threads
    - '8'
  cwd: {{ SMR_SRC }}
  validate:
    func:
    num_reads: 49309188
    num_hits:   2499868
    num_fail:  46809320
    num_hits_db:
      euk_28s_id98: 0.51
      euk_18s_id95: 0.02
      bac_23s_id98: 3.18
      bac_16s_id90: 1.33
      arc_23s_id98: 0
      arc_16s_id95: 0
      nc_5s_id98:   0.03  # non-coding - RFAM
      nc_5.8s_id98: 0     # non-coding - RFAM
    variant:     sanger # fastq quality variant
    time:
      win_8_16:
        host: Windows 10 + 8 CPUs + 16 GiB RAM
        notes: |
          Win apparently limits the amount of memory available to the process, 
          which seems to slow it down because less memory is available to RocksDB. 
          On Ubuntu the memory used by the process is much higher, and the process runs faster.
        cpu_load_align: [0, 0,    ] 
        total: 17587.01 # sec ~5hrs
        reads_stats_calc: [48.9792, 51.3097]
        index_stats_calc: [3.28]
        align:
          # [ load idx, load refs, align   ] # sec
          - [1.524470, 0.1747970, 997.416]
          - [1.493490, 0.1027610, 1088.52]
          - [1.743100, 0.1538530, 1225.69]
          - [2.095270, 0.1605110, 1403.62]
          - [0.578855, 0.0110253, 759.637]
          - [0.622625, 0.0311962, 884.362]
          - [1.437610, 0.1885500, 1061.30]
          - [0.815040, 0.0601514, 888.134]
        stats:   []
        reports: []
      ubuntu18_4_16_32:
        host: AWS t3.xlarge + Ubuntu 18 + 4 cpu + 16 GB RAM + 32 GB HDD
      ubuntu18_8_16_32:
        host: AWS c5.2xlarge + Ubuntu 18 + 8 cpu + 16 GB RAM + 32 GB HDD
        total:
        reads_stats_calc: [75.4094, 75.6198]
        index_stats_calc: [4.05]
        align:
          # [ load idx, load refs, align   ] # sec
          - [0.626602, 0.0234840, 634.723]
          - [0.505618, 0.0173236, 652.722]
          - [0.474568, 0.0158996, 729.239]
          - [0.715952, 0.0316894, ]
          - [] # ExecutionTimedOut bug
      ubuntu18_16_64_32:
        host: AWS m5.4xlarge + Ubuntu 18 + 16 cpu + 64 GB RAM + 32 GB HD
        # alignment cpu load: [ max,   min,  avr]
        cpu_load_align:       [] 
        total:  # sec - python trace from command sent to response received - with indexing
        reads_stats_calc: [81.6487, 81.9596]
        index_stats_calc: [ ]
        align:
          # [ load idx, load refs, align   ] # sec
          - []
          - []
          - []
          - []
          - []
          - []
          - []
          - []
      ubuntu18_32_128_32:
        # ~10 min to setup the instance and run the test: 1.536 / 6 = 0.256 per test
        host: AWS m5.8xlarge + Ubuntu 18 + 32 cpu + 128 GB RAM + 32 GB HD
        # alignment cpu load: [ max,   min,  avr]
        cpu_load_align:       [] 
        total:  # sec - python trace from command sent to response received - with indexing
        reads_stats_calc: []
        index_stats_calc: [ ]
        align:
          # [ load idx, load refs, align   ] # sec
          - []
          - []
          - []
          - []
          - []
          - []
          - []
          - []
    memory:
      prior_idx_load: [  5100, ]
      idx_load:       [378400, ]
      ref_load:       [395924.]
      align_done:     [608508, 568984, 1185272, 1897344, 1702888, 1793292, ?, ?]
      idx_ref_unloaded: